generator client {
  provider      = "prisma-client-js"
  output        = "../data-sync/node_modules/.prisma/client"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model ClientView {
  phoneNumber        String    @id
  name               String?
  userName           String?
  labels             String?
  chatId             String?   @unique
  lastActivity       DateTime  @updatedAt
  threadId           String?
  threadTokenCount   Int?      @default(0)
  profileStatus      String?
  proximaAccion      String?
  fechaProximaAccion DateTime?
  prioridad          Int?
}

model hotel_apartments {
  id          Int    @id @default(autoincrement())
  propertyId  Int    @map("property_id")
  roomId      Int    @unique @map("room_id")
  roomName    String @map("room_name")
  extraCharge Json   @default("{\"amount\": 70000, \"description\": \"Cargo adicional:\"}") @map("extra_charge")
  capacity    Int    @default(4)
}

model Booking {
  id            Int      @id @default(autoincrement())
  bookingId     String   @unique
  phone         String?
  guestName     String?
  status        String?
  internalNotes String?
  propertyName  String?
  arrivalDate   String?
  departureDate String?
  numNights     Int?
  totalPersons  Int?
  totalCharges  String?
  totalPayments String?
  balance       String?
  basePrice     String?
  channel       String?
  email         String?
  apiReference  String?
  charges       Json     @default("[]")
  payments      Json     @default("[]")
  messages      Json     @default("[]")
  infoItems     Json     @default("[]")
  notes         String?
  bookingDate   String?
  modifiedDate  String?
  lastUpdatedBD DateTime @default(now())
  raw           Json?
  BDStatus      String?

  @@index([arrivalDate])
  @@index([bookingId])
  @@index([channel])
  @@index([departureDate])
  @@index([guestName])
  @@index([modifiedDate])
  @@index([phone])
  @@index([propertyName, departureDate])
  @@index([status])
}

// Optimized Leads table - Only essential fields for sales conversion
// Purpose: Track "Futura Pendiente" bookings until they pay deposit

model Leads {
  id            Int      @id @default(autoincrement())
  bookingId     String   @unique
  guestName     String
  phone         String
  propertyName  String
  arrivalDate   DateTime @db.Date // Only date, no time
  departureDate DateTime @db.Date // Only date, no time
  numNights     Int
  totalPersons  Int
  channel       String
  createdAt     DateTime @default(now())

  @@index([arrivalDate])
  @@index([phone])
  @@index([channel])
  @@index([propertyName, arrivalDate])
}

model IA_CMR_Clientes {
  phoneNumber        String    @id
  profileStatus      String?
  proximaAccion      String?
  fechaProximaAccion DateTime?
  prioridad          Int?

  @@index([fechaProximaAccion])
  @@index([prioridad])
}
