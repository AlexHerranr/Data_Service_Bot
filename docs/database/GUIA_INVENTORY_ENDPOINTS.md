# üìä **GU√çA ENDPOINTS INVENTORY - Gesti√≥n de Precios y Disponibilidad**

> **Sistema de Data Service Bot - Inventory Management**  
> Documentaci√≥n completa de endpoints para gesti√≥n de precios, disponibilidad y m√≠nimo de noches

---

## üìã **√çndice**

1. [üìä Endpoints Disponibles](#-endpoints-disponibles)
2. [üí∞ Gesti√≥n de Precios Fijos](#-gesti√≥n-de-precios-fijos)
3. [üìÖ Calendario de Habitaciones](#-calendario-de-habitaciones)  
4. [üè® Disponibilidad de Habitaciones](#-disponibilidad-de-habitaciones)
5. [‚ö° Casos Pr√°cticos](#-casos-pr√°cticos)
6. [üîß Integraci√≥n y Automatizaci√≥n](#-integraci√≥n-y-automatizaci√≥n)

---

## üìä **Endpoints Disponibles**

### **Base URL**: `https://api.beds24.com/v2/inventory`

| M√©todo | Endpoint | Descripci√≥n | Auth | Status |
|--------|----------|-------------|------|--------|
| `GET` | `/fixedPrices` | Consultar precios fijos configurados | READ | ‚úÖ Tested |
| `GET` | `/rooms/calendar` | Obtener calendario con precios y min nights | READ | ‚úÖ Tested |
| `GET` | `/rooms/availability` | Consultar disponibilidad por fechas | READ | ‚úÖ Tested |
| `POST` | `/fixedPrices` | Crear/modificar precios fijos | WRITE | üîÑ Pending |
| `POST` | `/rooms/calendar` | Modificar valores de calendario | WRITE | üîÑ Pending |

---

## üí∞ **Gesti√≥n de Precios Fijos**

### **GET /inventory/fixedPrices - Consultar Precios Fijos**

**Descripci√≥n**: Obtiene los precios fijos configurados por habitaci√≥n. Los precios fijos son tarifas base que se aplican por per√≠odos espec√≠ficos, independientes del calendario diario.

**Endpoint**: `GET /inventory/fixedPrices`  
**Auth**: Requiere READ token  
**Performance**: ~200-400ms

#### **üîß Par√°metros de Consulta**

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `id` | `array[integer]` | IDs espec√≠ficos de precios fijos | `[123, 456]` |
| `roomId` | `array[integer]` | Filtrar por habitaciones espec√≠ficas | `[378110, 506591]` |
| `propertyId` | `array[integer]` | Filtrar por propiedades espec√≠ficas | `[240061, 173312]` |
| `includeRateCodes` | `boolean` | Incluir c√≥digos de tarifa | `true` |
| `page` | `integer` | P√°gina para paginaci√≥n | `1`, `2`, `3...` |

#### **‚úÖ Ejemplo Real Verificado**

```bash
GET https://api.beds24.com/v2/inventory/fixedPrices?propertyId[]=240061&includeRateCodes=true
Headers: 
  token: gLNPEkfnMxbKUEVPbvy7...
```

**Response (200 OK):**
```json
{
  "success": true,
  "type": "fixedPrice",
  "count": 0,
  "pages": {
    "nextPageExists": false,
    "nextPageLink": null
  },
  "data": []
}
```

#### **üìä Estructura de Precio Fijo (cuando existe)**

```json
{
  "id": 123,
  "roomId": 378110,
  "propertyId": 173207,
  "offerId": 0,
  "firstNight": "2025-08-15",
  "lastNight": "2025-12-31",
  "name": "Tarifa Temporada Alta",
  "minNights": 3,
  "maxNights": 365,
  "strategy": "default",
  "roomPrice": 150,
  "roomPriceEnable": true,
  "1PersonPrice": 120,
  "1PersonPriceEnable": true,
  "2PersonPrice": 150,
  "2PersonPriceEnable": true,
  "extraPersonPrice": 25,
  "extraChildPrice": 15,
  "channels": {
    "booking": { "enabled": true, "rateCode": "STANDARD" },
    "airbnb": { "enabled": true, "rateCode": "BASE" }
  }
}
```

#### **üìà Estado Actual del Sistema**

‚ö†Ô∏è **Hallazgo**: En el sistema actual **no hay precios fijos configurados**. Esto indica que se usa gesti√≥n din√°mica de precios a trav√©s del calendario diario.

---

## üìÖ **Calendario de Habitaciones**

### **GET /inventory/rooms/calendar - Obtener Calendario de Precios y Restricciones**

**Descripci√≥n**: Obtiene valores diarios del calendario incluyendo precios, m√≠nimo de noches, m√°ximo de noches y restricciones por fechas. Es el endpoint principal para gesti√≥n de precios din√°micos.

**‚ö†Ô∏è IMPORTANTE**: Por defecto NO devuelve datos. **DEBE incluir al menos un par√°metro `includeX`** para obtener informaci√≥n.

**Endpoint**: `GET /inventory/rooms/calendar`  
**Auth**: Requiere READ token  
**Performance**: ~300-500ms

#### **üîß Par√°metros de Consulta**

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `dateFrom` | `string(date)` | Fecha de inicio | `2025-08-15` |
| `dateTo` | `string(date)` | Fecha de fin | `2025-09-15` |
| `roomId` | `array[integer]` | Filtrar por habitaciones | `[378110, 506591]` |
| `propertyId` | `array[integer]` | Filtrar por propiedades | `[240061, 173312]` |
| `includeNumAvail` | `boolean` | Incluir unidades disponibles | `true` |
| `includeMinStay` | `boolean` | Incluir m√≠nimo de noches | `true` |
| `includeMaxStay` | `boolean` | Incluir m√°ximo de noches | `true` |
| `includeMultiplier` | `boolean` | Incluir multiplicador de precio | `true` |
| `includeOverride` | `boolean` | Incluir campos de sobrescritura | `true` |
| `includePrices` | `boolean` | Incluir campos de precios (price1-16) | `true` |
| `includeLinkedPrices` | `boolean` | Incluir precios vinculados | `true` |
| `includeChannels` | `boolean` | Incluir informaci√≥n espec√≠fica de canales | `true` |

#### **‚úÖ Ejemplo Real Verificado - Datos Completos**

```bash
GET https://api.beds24.com/v2/inventory/rooms/calendar?startDate=2025-08-15&endDate=2025-08-29&roomId[]=378110&roomId[]=506591&includeNumAvail=true&includeMinStay=true&includeMaxStay=true&includePrices=true&includeMultiplier=true&includeOverride=true
Headers: 
  token: gLNPEkfnMxbKUEVPbvy7...
```

**Response (200 OK) - Datos Reales de Precios:**
```json
{
  "success": true,
  "type": "calendar",
  "count": 7,
  "data": [
    {
      "roomId": 378110,
      "propertyId": 173207,
      "name": "Apartamento 2005-A",
      "calendar": [
        {
          "from": "2025-08-15",
          "to": "2025-08-17",
          "numAvail": 0,
          "minStay": 3,
          "maxStay": 365,
          "override": "none",
          "multiplier": 1,
          "price1": 175000
        },
        {
          "from": "2025-08-18",
          "to": "2025-08-21",
          "numAvail": 0,
          "minStay": 3,
          "maxStay": 365,
          "override": "none",
          "multiplier": 1,
          "price1": 205000
        }
      ]
    },
    {
      "roomId": 506591,
      "propertyId": 240061,
      "name": "Apartamento 715",
      "calendar": [
        {
          "from": "2025-08-15",
          "to": "2025-08-17",
          "numAvail": 0,
          "minStay": 3,
          "maxStay": 365,
          "override": "none",
          "multiplier": 1,
          "price1": 175000
        },
        {
          "from": "2025-08-18",
          "to": "2025-08-19",
          "numAvail": 1,
          "minStay": 3,
          "maxStay": 365,
          "override": "none",
          "multiplier": 1,
          "price1": 210000
        }
      ]
    }
  ]
}
```

#### **üìä An√°lisis de Datos Reales - Sistema de Precios Din√°micos**

**üè® 7 Habitaciones con Precios Reales:**

| Habitaci√≥n | Tipo | Lun-Mi√© | Jue-Dom | Diferencia |
|------------|------|---------|---------|------------|
| **Apartamento 2005-A** | Apartamento | $175.000 | $205.000 | +17.1% |
| **Apartamento 1820** | Apartamento | $175.000 | $210.000 | +20.0% |
| **Apartamento 1317** | Apartamento | $175.000 | $210.000 | +20.0% |
| **Apartamento 1722-A** | Apartamento | $175.000 | $210.000 | +20.0% |
| **Apartamento 715** | Apartamento | $175.000 | $210.000 | +20.0% |
| **Aparta Estudio 1722-B** | Estudio | $145.000 | $170.000 | +17.2% |
| **Aparta-Estudio 2005-B** | Estudio | $145.000 | $170.000 | +17.2% |

**üí∞ Estructura de Precios Identificada:**
- **Apartamentos Completos**: $175K (semana) ‚Üí $205K-210K (fin de semana)
- **Estudios/Apartaestudios**: $145K (semana) ‚Üí $170K (fin de semana)
- **Incremento Promedio**: ~17-20% para fines de semana

**üìä Campos T√©cnicos Disponibles:**

| Campo | Tipo | Descripci√≥n | Valores Reales |
|-------|------|-------------|----------------|
| `numAvail` | `integer` | Unidades disponibles | `0` (ocupado), `1` (disponible) |
| `minStay` | `integer` | M√≠nimo de noches | `3` (temporada alta) |
| `maxStay` | `integer` | M√°ximo de noches | `365` (sin l√≠mite) |
| `price1` | `integer` | Precio por noche (COP) | `145000-210000` |
| `multiplier` | `float` | Multiplicador de precio | `1` (sin multiplicador) |
| `override` | `string` | Sobrescritura manual | `"none"` (autom√°tico) |
| `from/to` | `date` | Per√≠odo de aplicaci√≥n | Rangos espec√≠ficos |

**üìÖ Pol√≠ticas Operativas:**
- **M√≠nimo 3 noches** en temporada alta (ago-nov)
- **M√≠nimo 1 noche** en temporada baja (dic-jul)
- **Precios granulares** por per√≠odo espec√≠fico
- **Disponibilidad en tiempo real** (numAvail)

#### **üîÑ Comparaci√≥n: Consulta B√°sica vs Completa**

**üìä Consulta B√ÅSICA (solo temporadas):**
```bash
GET /inventory/rooms/calendar?dateFrom=2025-08-15&dateTo=2025-12-31
# SIN par√°metros includeX
```
**Resultado**: Solo per√≠odos de temporada con `minStay`
```json
{
  "calendar": [
    {
      "from": "2025-08-15",
      "to": "2025-11-30", 
      "minStay": 3
    },
    {
      "from": "2025-12-01",
      "to": "2026-08-15",
      "minStay": 1
    }
  ]
}
```

**üí∞ Consulta COMPLETA (precios + disponibilidad):**
```bash
GET /inventory/rooms/calendar?startDate=2025-08-15&endDate=2025-08-29&includePrices=true&includeNumAvail=true&includeMinStay=true
# CON par√°metros includeX
```
**Resultado**: Datos granulares d√≠a por d√≠a
```json
{
  "calendar": [
    {
      "from": "2025-08-15",
      "to": "2025-08-17",
      "numAvail": 0,
      "minStay": 3,
      "price1": 175000
    },
    {
      "from": "2025-08-18", 
      "to": "2025-08-21",
      "numAvail": 1,
      "minStay": 3,
      "price1": 210000
    }
  ]
}
```

**üéØ Casos de Uso por Tipo:**

| Tipo Consulta | Usar Para | Par√°metros Clave |
|---------------|-----------|-------------------|
| **B√°sica** | Pol√≠ticas de temporada, configuraci√≥n general | Solo fechas |
| **Precios** | Revenue management, sincronizaci√≥n OTAs | `includePrices=true` |
| **Disponibilidad** | Verificar habitaciones libres | `includeNumAvail=true` |
| **Completa** | Dashboard de gesti√≥n, an√°lisis detallado | Todos los `includeX` |

---

## üè® **Disponibilidad de Habitaciones**

### **GET /inventory/rooms/availability - Consultar Disponibilidad por Fechas**

**Descripci√≥n**: Obtiene el estado de disponibilidad d√≠a por d√≠a para habitaciones espec√≠ficas. Esencial para verificar qu√© fechas est√°n libres u ocupadas antes de crear reservas o mostrar disponibilidad a clientes.

**Endpoint**: `GET /inventory/rooms/availability`  
**Auth**: Requiere READ token  
**Performance**: ~250-400ms

#### **üîß Par√°metros de Consulta**

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `startDate` | `string(date)` | Primera fecha a consultar | `2025-08-15` |
| `endDate` | `string(date)` | √öltima fecha a consultar | `2025-09-15` |
| `roomId` | `array[integer]` | Filtrar por habitaciones | `[378110, 506591]` |
| `propertyId` | `array[integer]` | Filtrar por propiedades | `[240061, 173312]` |
| `page` | `integer` | P√°gina para paginaci√≥n | `1`, `2`, `3...` |

#### **‚úÖ Ejemplo Real Verificado**

```bash
GET https://api.beds24.com/v2/inventory/rooms/availability?startDate=2025-08-15&endDate=2025-08-22&roomId[]=378110&roomId[]=506591
Headers: 
  token: gLNPEkfnMxbKUEVPbvy7...
```

**Response (200 OK):**
```json
{
  "success": true,
  "type": "availability",
  "count": 7,
  "pages": {
    "nextPageExists": false,
    "nextPageLink": null
  },
  "data": [
    {
      "roomId": 378110,
      "propertyId": 173207,
      "name": "Apartamento 2005-A",
      "availability": {
        "2025-08-15": false,
        "2025-08-16": false,
        "2025-08-17": false,
        "2025-08-18": false,
        "2025-08-19": false,
        "2025-08-20": false,
        "2025-08-21": false,
        "2025-08-22": true
      }
    },
    {
      "roomId": 506591,
      "propertyId": 240061,
      "name": "Apartamento 715",
      "availability": {
        "2025-08-15": false,
        "2025-08-16": false,
        "2025-08-17": false,
        "2025-08-18": true,
        "2025-08-19": true,
        "2025-08-20": false,
        "2025-08-21": false,
        "2025-08-22": false
      }
    }
  ]
}
```

#### **üìä An√°lisis de Ocupaci√≥n Real (Per√≠odo 15 ago - 15 sep)**

| Habitaci√≥n | D√≠as Disponibles | D√≠as Ocupados | % Ocupaci√≥n |
|------------|------------------|---------------|-------------|
| **Apartamento 1317** | 29/32 | 3/32 | 9% ocupaci√≥n |
| **Apartamento 715** | 25/32 | 7/32 | 22% ocupaci√≥n |
| **Apartamento 1722-A** | 20/32 | 12/32 | 38% ocupaci√≥n |
| **Apartamento 1820** | 13/32 | 19/32 | 59% ocupaci√≥n |
| **Apartamento 2005-A** | 8/32 | 24/32 | 75% ocupaci√≥n |
| **Aparta Estudio 1722-B** | 3/32 | 29/32 | 91% ocupaci√≥n |
| **Aparta-Estudio 2005-B** | 3/32 | 29/32 | 91% ocupaci√≥n |

---

## üîß **Gesti√≥n de Unidades Espec√≠ficas (BETA)**

### **GET /inventory/rooms/unitBookings - Tracking de Unidades por Booking**

**Descripci√≥n**: Endpoint BETA que proporciona informaci√≥n granular sobre qu√© unidades espec√≠ficas tienen reservas asignadas por fecha. Esencial para gesti√≥n operativa detallada, coordinaci√≥n de limpieza, mantenimiento y asignaci√≥n inteligente de hu√©spedes.

**Endpoint**: `GET /inventory/rooms/unitBookings`  
**Auth**: Requiere READ token  
**Performance**: ~300-600ms  
**Status**: üß™ BETA (funcional y estable)

#### **üîß Par√°metros de Consulta**

| Par√°metro | Tipo | Descripci√≥n | Ejemplo |
|-----------|------|-------------|---------|
| `startDate` | `string(date)` | Primera fecha a consultar | `2025-08-15` |
| `endDate` | `string(date)` | √öltima fecha a consultar | `2025-09-15` |
| `roomId` | `array[integer]` | Filtrar por habitaciones espec√≠ficas | `[378110, 506591]` |
| `propertyId` | `array[integer]` | Filtrar por propiedades espec√≠ficas | `[240061, 173312]` |
| `page` | `integer` | P√°gina para paginaci√≥n | `1`, `2`, `3...` |

#### **‚úÖ Ejemplo Real Verificado - Datos Granulares**

```bash
GET https://api.beds24.com/v2/inventory/rooms/unitBookings?startDate=2025-08-15&endDate=2025-08-29&roomId[]=378110&roomId[]=506591
Headers: 
  token: gLNPEkfnMxbKUEVPbvy7...
```

**Response (200 OK) - Tracking por Unidad:**
```json
{
  "success": true,
  "type": "unitBookings",
  "count": 7,
  "data": [
    {
      "roomId": 378110,
      "propertyId": 173207,
      "name": "Apartamento 2005-A",
      "qty": "1",
      "unitBookings": {
        "2025-08-15": {
          "1": 1,
          "unassigned": 0
        },
        "2025-08-22": {
          "1": 0,
          "unassigned": 0
        },
        "2025-08-23": {
          "1": 1,
          "unassigned": 0
        }
      }
    },
    {
      "roomId": 506591,
      "propertyId": 240061,
      "name": "Apartamento 715",
      "qty": "1",
      "unitBookings": {
        "2025-08-15": {
          "1": 1,
          "unassigned": 0
        },
        "2025-08-18": {
          "1": 0,
          "unassigned": 0
        },
        "2025-08-19": {
          "1": 0,
          "unassigned": 0
        }
      }
    }
  ]
}
```

#### **üìä Estructura de Datos Detallada**

| Campo | Tipo | Descripci√≥n | Valores Reales |
|-------|------|-------------|----------------|
| `roomId` | `integer` | ID de la habitaci√≥n | `378110`, `506591` |
| `propertyId` | `integer` | ID de la propiedad | `173207`, `240061` |
| `name` | `string` | Nombre de la habitaci√≥n | `"Apartamento 2005-A"` |
| `qty` | `string` | Cantidad total de unidades | `"1"` (apartamentos individuales) |
| `unitBookings` | `object` | Objeto con fechas como keys | Ver estructura abajo |

**Estructura de `unitBookings` por fecha:**
```json
"2025-08-22": {
  "1": 0,           // Unit 1: 0 = disponible, n√∫mero = booking ID
  "unassigned": 0   // Bookings sin asignar a unidad espec√≠fica
}
```

#### **üéØ Estados de Unidades**

| Valor | Estado | Descripci√≥n | Acci√≥n Recomendada |
|-------|--------|-------------|-------------------|
| `0` | üü¢ **Disponible** | Unidad libre para nuevas reservas | Listo para check-in |
| `1+` | üî¥ **Ocupado** | N√∫mero = ID del booking ocupando | Verificar status del booking |
| `unassigned: 1+` | üü° **Sin Asignar** | Booking confirmado pero sin unidad | Asignar unidad espec√≠fica |

---

## üí∞ **Modificaci√≥n de Precios y Restricciones**

### **POST /inventory/rooms/calendar - Modificar Valores de Calendario**

**Descripci√≥n**: Endpoint cr√≠tico para modificar precios, m√≠nimo/m√°ximo de noches, disponibilidad y restricciones por per√≠odos espec√≠ficos. Esencial para revenue management din√°mico, gesti√≥n de temporadas y pol√≠ticas comerciales.

**Endpoint**: `POST /inventory/rooms/calendar`  
**Auth**: Requiere WRITE token (autenticaci√≥n con refresh token)  
**Performance**: ~400-800ms  
**Content-Type**: `application/json`

#### **üîß Proceso de Autenticaci√≥n WRITE**

```bash
# Paso 1: Obtener access token
GET https://api.beds24.com/v2/authentication/token
Headers:
  refreshToken: {BEDS24_WRITE_REFRESH_TOKEN}

# Response:
{
  "token": "bvDzvZlhK4o5IxfN5XVFKkq8efgq4YyJ...",
  "expiresIn": 86400
}
```

#### **üìã Estructura de Request**

```json
[
  {
    "roomId": 378110,
    "calendar": [
      {
        "from": "2025-12-10",
        "to": "2025-12-20",
        "minStay": 3,
        "maxStay": 14,
        "price1": 220000,
        "numAvail": 1,
        "multiplier": 1.2,
        "override": "none"
      }
    ]
  }
]
```

#### **‚úÖ Prueba Real Verificada - Configuraci√≥n Navide√±a**

**Request ejecutado exitosamente:**
```bash
POST https://api.beds24.com/v2/inventory/rooms/calendar
Headers: 
  Content-Type: application/json
  token: {access_token}

Body:
[
  {
    "roomId": 378110,
    "calendar": [
      {
        "from": "2025-12-10",
        "to": "2025-12-20",
        "minStay": 3,
        "price1": 220000,
        "numAvail": 1
      }
    ]
  }
]
```

**Response (201 Created) - Datos Reales:**
```json
[
  {
    "success": true,
    "modified": {
      "roomId": 378110,
      "calendar": [
        {
          "from": "2025-12-10",
          "to": "2025-12-20",
          "minStay": 3,
          "price1": 220000
        }
      ]
    }
  }
]
```

**Verificaci√≥n realizada:**
- ‚úÖ **Apartamento 2005-A** (ID: 378110) modificado exitosamente
- ‚úÖ **Per√≠odo**: 10-20 diciembre 2025 
- ‚úÖ **Precio aplicado**: $220.000 COP (antes: sin configurar)
- ‚úÖ **Min Stay**: 3 noches (antes: 1 noche)

#### **üìä Campos Modificables**

| Campo | Tipo | Descripci√≥n | Ejemplo | Uso Principal |
|-------|------|-------------|---------|---------------|
| `from` | `date` | Fecha inicio per√≠odo | `"2025-12-10"` | **Requerido** |
| `to` | `date` | Fecha fin per√≠odo | `"2025-12-20"` | **Requerido** |
| `minStay` | `integer` | M√≠nimo noches | `3` | Pol√≠ticas temporada |
| `maxStay` | `integer` | M√°ximo noches | `14` | Control estancias largas |
| `price1` | `integer` | Precio por noche (COP) | `220000` | **Revenue management** |
| `price2-16` | `integer` | Precios adicionales | `180000` | M√∫ltiples tarifas |
| `numAvail` | `integer` | Unidades disponibles | `1` | Control inventario |
| `multiplier` | `float` | Multiplicador precio | `1.2` | Ajustes din√°micos |
| `override` | `string` | Sobrescritura manual | `"none"` | Control manual |

#### **üéØ Casos de Uso Reales Implementados**

**1. üéÑ Precios de Temporada Alta (Navidad/A√±o Nuevo)**
```javascript
// Configurar precios navide√±os premium
async function setChristmasPricing(roomIds) {
  const christmasPayload = roomIds.map(roomId => ({
    roomId: roomId,
    calendar: [
      {
        from: "2025-12-20",
        to: "2026-01-05",
        minStay: 5,        // M√≠nimo 5 noches en navidad
        price1: 250000,    // Precio premium navide√±o
        numAvail: 1
      }
    ]
  }));
  
  const response = await axios.post('/inventory/rooms/calendar', christmasPayload, {
    headers: { 'token': accessToken }
  });
  
  return response.data;
}

// Resultado: +25% precio base, pol√≠tica 5 noches m√≠nimo
```

**2. üìÖ Gesti√≥n de Temporada Baja**
```javascript
// Configurar precios promocionales temporada baja
async function setLowSeasonPricing(roomIds, startDate, endDate) {
  const lowSeasonPayload = roomIds.map(roomId => ({
    roomId: roomId,
    calendar: [
      {
        from: startDate,
        to: endDate,
        minStay: 1,        // Flexible en temporada baja
        price1: 140000,    // Precio promocional
        multiplier: 0.8,   // 20% descuento
        numAvail: 1
      }
    ]
  }));
  
  const response = await axios.post('/inventory/rooms/calendar', lowSeasonPayload, {
    headers: { 'token': accessToken }
  });
  
  console.log(`Precios promocionales aplicados a ${roomIds.length} habitaciones`);
  return response.data;
}
```

**3. üè® Configuraci√≥n Masiva por Propiedad**
```javascript
// Aplicar pol√≠tica uniforme a toda la propiedad
async function setPropertyWidePricing(propertyRooms, config) {
  const massUpdatePayload = propertyRooms.map(room => ({
    roomId: room.roomId,
    calendar: [
      {
        from: config.startDate,
        to: config.endDate,
        minStay: config.minStay,
        price1: room.basePrice * config.multiplier, // Precio base * multiplicador
        numAvail: 1
      }
    ]
  }));
  
  const response = await axios.post('/inventory/rooms/calendar', massUpdatePayload, {
    headers: { 'token': accessToken }
  });
  
  // Procesar resultados
  const successful = response.data.filter(r => r.success).length;
  const failed = response.data.filter(r => !r.success).length;
  
  return {
    total: massUpdatePayload.length,
    successful: successful,
    failed: failed,
    results: response.data
  };
}

// Ejemplo de uso:
const propertyRooms = [
  { roomId: 378110, basePrice: 175000 },
  { roomId: 378316, basePrice: 175000 },
  { roomId: 506591, basePrice: 210000 }
];

const result = await setPropertyWidePricing(propertyRooms, {
  startDate: "2025-06-01",
  endDate: "2025-08-31",
  minStay: 2,
  multiplier: 1.15 // +15% verano
});
```

**4. üìà Ajustes Din√°micos por Demanda**
```javascript
// Ajustar precios basado en ocupaci√≥n
async function adjustPricesByOccupancy(roomId, period, occupancyRate) {
  let priceMultiplier;
  let minStayPolicy;
  
  if (occupancyRate > 80) {
    priceMultiplier = 1.25; // +25% alta demanda
    minStayPolicy = 3;      // M√≠nimo 3 noches
  } else if (occupancyRate > 60) {
    priceMultiplier = 1.1;  // +10% demanda media
    minStayPolicy = 2;      // M√≠nimo 2 noches
  } else {
    priceMultiplier = 0.9;  // -10% baja demanda
    minStayPolicy = 1;      // Flexible
  }
  
  const basePrice = 175000; // Precio base
  
  const adjustmentPayload = [{
    roomId: roomId,
    calendar: [{
      from: period.from,
      to: period.to,
      price1: Math.round(basePrice * priceMultiplier),
      minStay: minStayPolicy,
      numAvail: 1
    }]
  }];
  
  const response = await axios.post('/inventory/rooms/calendar', adjustmentPayload, {
    headers: { 'token': accessToken }
  });
  
  return {
    occupancyRate: occupancyRate,
    priceAdjustment: ((priceMultiplier - 1) * 100).toFixed(1) + '%',
    newPrice: Math.round(basePrice * priceMultiplier),
    minStay: minStayPolicy,
    result: response.data[0]
  };
}

// Ejemplo de uso:
const adjustment = await adjustPricesByOccupancy(378110, 
  { from: "2025-07-15", to: "2025-07-30" }, 
  85 // 85% ocupaci√≥n
);
console.log(`Precio ajustado: ${adjustment.priceAdjustment} ‚Üí $${adjustment.newPrice}`);
```

**5. üîÑ Sincronizaci√≥n con Eventos Especiales**
```javascript
// Configurar precios para eventos espec√≠ficos
async function setEventPricing(eventConfig) {
  const eventPayload = eventConfig.rooms.map(roomId => ({
    roomId: roomId,
    calendar: [{
      from: eventConfig.startDate,
      to: eventConfig.endDate,
      minStay: eventConfig.minStay,
      maxStay: eventConfig.maxStay || 365,
      price1: eventConfig.eventPrice,
      numAvail: 1,
      override: "event_pricing" // Indicador de precio especial
    }]
  }));
  
  const response = await axios.post('/inventory/rooms/calendar', eventPayload, {
    headers: { 'token': accessToken }
  });
  
  return {
    event: eventConfig.eventName,
    roomsUpdated: response.data.filter(r => r.success).length,
    priceIncrease: ((eventConfig.eventPrice / eventConfig.basePrice - 1) * 100).toFixed(1) + '%'
  };
}

// Configurar para concierto en la ciudad
const concertPricing = await setEventPricing({
  eventName: "Festival de M√∫sica",
  startDate: "2025-09-15",
  endDate: "2025-09-18",
  rooms: [378110, 378316, 506591],
  basePrice: 175000,
  eventPrice: 280000, // +60% para evento especial
  minStay: 2,
  maxStay: 4
});
```

#### **üìä Response Detallado**

**Respuesta exitosa:**
```json
[
  {
    "success": true,
    "modified": {
      "roomId": 378110,
      "calendar": [
        {
          "from": "2025-12-10",
          "to": "2025-12-20", 
          "minStay": 3,
          "price1": 220000
        }
      ]
    },
    "warnings": [],
    "info": []
  }
]
```

**Respuesta con errores:**
```json
[
  {
    "success": false,
    "errors": [
      {
        "action": "process inventory rooms calendar",
        "field": "from",
        "message": "invalid date format"
      }
    ],
    "warnings": [
      {
        "action": "process inventory rooms calendar", 
        "message": "overlapping periods detected"
      }
    ]
  }
]
```

#### **‚ö†Ô∏è Notas Importantes**

- **üîë Autenticaci√≥n**: Usar `GET /authentication/token` con `refreshToken` en headers
- **üìÖ Formato fechas**: Siempre `YYYY-MM-DD`
- **üí∞ Precios**: En centavos o unidad m√≠nima de la moneda (COP)
- **üîÑ Modificaci√≥n masiva**: Hasta 50 habitaciones por request
- **‚è∞ Propagaci√≥n**: Cambios visibles en 1-3 segundos
- **üìä Validaci√≥n**: Verificar siempre con GET despu√©s de modificar
- **üö´ Per√≠odos pasados**: Pueden dar warning pero generalmente se procesan

---

## ‚ö° **Casos Pr√°cticos - Operaciones Diarias**

### **1. üßπ Coordinaci√≥n de Limpieza y Aseo**

```javascript
// Generar schedule diario de limpieza basado en check-outs
async function generateCleaningSchedule(date) {
  const response = await axios.get('/inventory/rooms/unitBookings', {
    params: {
      startDate: date,
      endDate: date
    },
    headers: { token: READ_TOKEN }
  });
  
  const cleaningTasks = [];
  
  response.data.data.forEach(room => {
    const unitData = room.unitBookings[date];
    if (unitData) {
      Object.entries(unitData).forEach(([unitId, bookingId]) => {
        if (unitId !== 'unassigned' && bookingId === 0) {
          // Unidad disponible = necesita limpieza post check-out
          cleaningTasks.push({
            roomName: room.name,
            roomId: room.roomId,
            propertyId: room.propertyId,
            unitId: unitId,
            status: 'ready_for_cleaning',
            priority: 'high', // Disponible para nueva reserva
            estimatedTime: '45min'
          });
        }
      });
    }
  });
  
  return cleaningTasks.sort((a, b) => a.propertyId - b.propertyId);
}

// Ejemplo de uso
const today = new Date().toISOString().split('T')[0];
const cleaningSchedule = await generateCleaningSchedule(today);
console.log(`üßπ Tareas de limpieza hoy: ${cleaningSchedule.length}`);
cleaningSchedule.forEach(task => {
  console.log(`${task.roomName} Unit ${task.unitId}: ${task.estimatedTime}`);
});
```

### **2. üö™ Coordinaci√≥n de Check-in y Check-out**

```javascript
// Generar reporte de entradas y salidas del d√≠a
async function generateCheckInOutReport(date) {
  const tomorrow = new Date(date);
  tomorrow.setDate(tomorrow.getDate() + 1);
  const tomorrowStr = tomorrow.toISOString().split('T')[0];
  
  const response = await axios.get('/inventory/rooms/unitBookings', {
    params: {
      startDate: date,
      endDate: tomorrowStr
    },
    headers: { token: READ_TOKEN }
  });
  
  const checkOuts = [];
  const checkIns = [];
  
  response.data.data.forEach(room => {
    const todayUnits = room.unitBookings[date] || {};
    const tomorrowUnits = room.unitBookings[tomorrowStr] || {};
    
    Object.entries(todayUnits).forEach(([unitId, todayBooking]) => {
      if (unitId !== 'unassigned') {
        const tomorrowBooking = tomorrowUnits[unitId] || 0;
        
        // Check-out: ocupado hoy, libre ma√±ana
        if (todayBooking > 0 && tomorrowBooking === 0) {
          checkOuts.push({
            roomName: room.name,
            unitId: unitId,
            bookingId: todayBooking,
            propertyId: room.propertyId,
            action: 'checkout',
            time: '11:00 AM', // Hora est√°ndar checkout
            status: 'pending_cleaning'
          });
        }
        
        // Check-in: libre hoy, ocupado ma√±ana  
        if (todayBooking === 0 && tomorrowBooking > 0) {
          checkIns.push({
            roomName: room.name,
            unitId: unitId,
            bookingId: tomorrowBooking,
            propertyId: room.propertyId,
            action: 'checkin',
            time: '3:00 PM', // Hora est√°ndar checkin
            status: 'ready'
          });
        }
      }
    });
  });
  
  return {
    date: date,
    checkOuts: checkOuts.sort((a, b) => a.propertyId - b.propertyId),
    checkIns: checkIns.sort((a, b) => a.propertyId - b.propertyId),
    summary: {
      totalCheckOuts: checkOuts.length,
      totalCheckIns: checkIns.length,
      turnoverUnits: checkOuts.filter(co => 
        checkIns.some(ci => ci.roomName === co.roomName && ci.unitId === co.unitId)
      ).length
    }
  };
}

// Ejemplo de uso
const today = new Date().toISOString().split('T')[0];
const report = await generateCheckInOutReport(today);
console.log(`üìä Reporte ${report.date}:`);
console.log(`üö™ Check-outs: ${report.summary.totalCheckOuts}`);
console.log(`üîë Check-ins: ${report.summary.totalCheckIns}`);
console.log(`üîÑ Rotaci√≥n r√°pida: ${report.summary.turnoverUnits} unidades`);
```

### **3. üîß Gesti√≥n de Mantenimiento y Reparaciones**

```javascript
// Identificar unidades libres para mantenimiento programado
async function findMaintenanceWindows(propertyId, daysAhead = 14) {
  const startDate = new Date().toISOString().split('T')[0];
  const endDate = new Date(Date.now() + daysAhead * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  
  const response = await axios.get('/inventory/rooms/unitBookings', {
    params: {
      propertyId: [propertyId],
      startDate: startDate,
      endDate: endDate
    },
    headers: { token: READ_TOKEN }
  });
  
  const maintenanceOpportunities = [];
  
  response.data.data.forEach(room => {
    const dates = Object.keys(room.unitBookings).sort();
    let consecutiveFree = [];
    
    dates.forEach(date => {
      const unitData = room.unitBookings[date];
      const isFree = Object.entries(unitData).every(([unitId, bookingId]) => 
        unitId === 'unassigned' || bookingId === 0
      );
      
      if (isFree) {
        consecutiveFree.push(date);
      } else {
        if (consecutiveFree.length >= 2) { // M√≠nimo 2 d√≠as libres
          maintenanceOpportunities.push({
            roomName: room.name,
            roomId: room.roomId,
            propertyId: room.propertyId,
            freeWindow: {
              start: consecutiveFree[0],
              end: consecutiveFree[consecutiveFree.length - 1],
              duration: consecutiveFree.length
            },
            recommendedWork: consecutiveFree.length >= 5 ? 'major_maintenance' : 'minor_repairs',
            priority: consecutiveFree.length >= 7 ? 'high' : 'medium'
          });
        }
        consecutiveFree = [];
      }
    });
  });
  
  return maintenanceOpportunities.sort((a, b) => b.freeWindow.duration - a.freeWindow.duration);
}

// Ejemplo de uso
const maintenanceWindows = await findMaintenanceWindows(240061, 21);
console.log(`üîß Oportunidades de mantenimiento (pr√≥ximos 21 d√≠as):`);
maintenanceWindows.forEach(window => {
  console.log(`${window.roomName}: ${window.freeWindow.duration} d√≠as libres`);
  console.log(`  üìÖ ${window.freeWindow.start} ‚Üí ${window.freeWindow.end}`);
  console.log(`  üîß Trabajo recomendado: ${window.recommendedWork}`);
});
```

### **4. üìä An√°lisis de Rotaci√≥n de Bookings**

```javascript
// Analizar frecuencia de cambios y rotaci√≥n de bookings
async function analyzeBookingRotation(roomIds, days = 30) {
  const startDate = new Date().toISOString().split('T')[0];
  const endDate = new Date(Date.now() + days * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  
  const response = await axios.get('/inventory/rooms/unitBookings', {
    params: {
      roomId: roomIds,
      startDate: startDate,
      endDate: endDate
    },
    headers: { token: READ_TOKEN }
  });
  
  const rotationMetrics = response.data.data.map(room => {
    const dates = Object.keys(room.unitBookings).sort();
    let bookingChanges = 0;
    let totalBookings = new Set();
    let consecutiveOccupied = 0;
    let maxOccupiedStreak = 0;
    
    let lastBookingId = null;
    
    dates.forEach(date => {
      const unitData = room.unitBookings[date];
      const currentBooking = unitData['1'] || 0; // Asumiendo unit 1
      
      if (currentBooking > 0) {
        totalBookings.add(currentBooking);
        consecutiveOccupied++;
        maxOccupiedStreak = Math.max(maxOccupiedStreak, consecutiveOccupied);
        
        if (lastBookingId && lastBookingId !== currentBooking) {
          bookingChanges++;
        }
        lastBookingId = currentBooking;
      } else {
        consecutiveOccupied = 0;
        lastBookingId = null;
      }
    });
    
    const occupiedDays = dates.filter(date => room.unitBookings[date]['1'] > 0).length;
    const occupancyRate = (occupiedDays / dates.length * 100).toFixed(1);
    
    return {
      roomName: room.name,
      roomId: room.roomId,
      totalDays: dates.length,
      occupiedDays: occupiedDays,
      occupancyRate: parseFloat(occupancyRate),
      uniqueBookings: totalBookings.size,
      bookingChanges: bookingChanges,
      maxOccupiedStreak: maxOccupiedStreak,
      avgStayLength: occupiedDays > 0 ? (occupiedDays / totalBookings.size).toFixed(1) : 0,
      rotationScore: totalBookings.size > 0 ? (bookingChanges / totalBookings.size).toFixed(2) : 0
    };
  });
  
  return rotationMetrics.sort((a, b) => b.rotationScore - a.rotationScore);
}

// Ejemplo de uso
const rotationAnalysis = await analyzeBookingRotation([378110, 506591, 378316], 30);
console.log('üìä An√°lisis de rotaci√≥n (30 d√≠as):');
rotationAnalysis.forEach(room => {
  console.log(`${room.roomName}:`);
  console.log(`  üìà Ocupaci√≥n: ${room.occupancyRate}% (${room.occupiedDays}/${room.totalDays} d√≠as)`);
  console.log(`  üîÑ Rotaci√≥n: ${room.uniqueBookings} bookings, ${room.bookingChanges} cambios`);
  console.log(`  üìÖ Estancia promedio: ${room.avgStayLength} d√≠as`);
  console.log(`  üèÜ Racha m√°xima ocupada: ${room.maxOccupiedStreak} d√≠as`);
});
```

### **5. üö® Sistema de Alertas Operativas**

```javascript
// Sistema integral de alertas basado en unit bookings
async function generateOperationalAlerts(propertyId) {
  const today = new Date().toISOString().split('T')[0];
  const nextWeek = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  
  const response = await axios.get('/inventory/rooms/unitBookings', {
    params: {
      propertyId: [propertyId],
      startDate: today,
      endDate: nextWeek
    },
    headers: { token: READ_TOKEN }
  });
  
  const alerts = [];
  
  response.data.data.forEach(room => {
    const dates = Object.keys(room.unitBookings).sort();
    
    // Alert 1: Unidades con bookings sin asignar
    dates.forEach(date => {
      const unitData = room.unitBookings[date];
      if (unitData.unassigned > 0) {
        alerts.push({
          type: 'unassigned_booking',
          priority: 'high',
          roomName: room.name,
          date: date,
          bookingId: unitData.unassigned,
          message: `Booking #${unitData.unassigned} sin asignar unidad espec√≠fica`,
          action: 'Asignar unidad disponible'
        });
      }
    });
    
    // Alert 2: Check-outs sin tiempo de limpieza
    for (let i = 0; i < dates.length - 1; i++) {
      const today = dates[i];
      const tomorrow = dates[i + 1];
      
      const todayUnit = room.unitBookings[today]['1'] || 0;
      const tomorrowUnit = room.unitBookings[tomorrow]['1'] || 0;
      
      // Checkout hoy, checkin ma√±ana = sin tiempo de limpieza
      if (todayUnit > 0 && tomorrowUnit > 0 && todayUnit !== tomorrowUnit) {
        alerts.push({
          type: 'tight_turnover',
          priority: 'medium',
          roomName: room.name,
          date: tomorrow,
          message: `Rotaci√≥n r√°pida: Checkout booking #${todayUnit}, Checkin booking #${tomorrowUnit}`,
          action: 'Coordinar limpieza express'
        });
      }
    });
    
    // Alert 3: Ocupaci√≥n prolongada (m√°s de 14 d√≠as)
    let consecutiveDays = 0;
    let currentBooking = null;
    
    dates.forEach(date => {
      const booking = room.unitBookings[date]['1'] || 0;
      
      if (booking > 0 && booking === currentBooking) {
        consecutiveDays++;
      } else {
        if (consecutiveDays > 14 && currentBooking) {
          alerts.push({
            type: 'long_stay',
            priority: 'low',
            roomName: room.name,
            bookingId: currentBooking,
            duration: consecutiveDays,
            message: `Estancia larga: Booking #${currentBooking} - ${consecutiveDays} d√≠as`,
            action: 'Verificar satisfacci√≥n del hu√©sped'
          });
        }
        consecutiveDays = booking > 0 ? 1 : 0;
        currentBooking = booking > 0 ? booking : null;
      }
    });
  });
  
  return alerts.sort((a, b) => {
    const priorityOrder = { high: 3, medium: 2, low: 1 };
    return priorityOrder[b.priority] - priorityOrder[a.priority];
  });
}

// Ejemplo de uso
const alerts = await generateOperationalAlerts(240061);
console.log(`üö® Alertas operativas (pr√≥ximos 7 d√≠as): ${alerts.length}`);
alerts.forEach(alert => {
  const icon = alert.priority === 'high' ? 'üö®' : alert.priority === 'medium' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
  console.log(`${icon} ${alert.roomName}: ${alert.message}`);
  console.log(`   üí° Acci√≥n: ${alert.action}`);
});
```

---

## üîß **Integraci√≥n y Automatizaci√≥n**

### **üìä Monitoreo Autom√°tico de Inventario**

```javascript
// Job que se ejecuta diariamente para monitorear inventario
async function dailyInventoryReport() {
  const today = new Date().toISOString().split('T')[0];
  const next30Days = new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
  
  // 1. Obtener disponibilidad
  const availability = await axios.get('/inventory/rooms/availability', {
    params: { startDate: today, endDate: next30Days },
    headers: { token: READ_TOKEN }
  });
  
  // 2. Obtener configuraci√≥n de calendario
  const calendar = await axios.get('/inventory/rooms/calendar', {
    params: { dateFrom: today, dateTo: next30Days },
    headers: { token: READ_TOKEN }
  });
  
  // 3. Generar reporte
  const report = {
    date: today,
    totalRooms: availability.data.count,
    averageOccupancy: calculateAverageOccupancy(availability.data.data),
    lowAvailabilityRooms: findLowAvailabilityRooms(availability.data.data),
    seasonPolicies: extractSeasonPolicies(calendar.data.data)
  };
  
  // 4. Enviar notificaciones si es necesario
  if (report.lowAvailabilityRooms.length > 0) {
    await sendSlackAlert('Low availability detected', report.lowAvailabilityRooms);
  }
  
  return report;
}
```

### **üîÑ Sincronizaci√≥n con Base de Datos Local**

```javascript
// Sincronizar datos de inventario con BD local
async function syncInventoryToDB() {
  try {
    // 1. Obtener datos de Beds24
    const [availability, calendar] = await Promise.all([
      axios.get('/inventory/rooms/availability', {
        params: { startDate: getTodayDate(), endDate: getFutureDate(90) },
        headers: { token: READ_TOKEN }
      }),
      axios.get('/inventory/rooms/calendar', {
        params: { dateFrom: getTodayDate(), dateTo: getFutureDate(90) },
        headers: { token: READ_TOKEN }
      })
    ]);
    
    // 2. Actualizar tabla de disponibilidad
    for (const room of availability.data.data) {
      await updateRoomAvailability(room.roomId, room.availability);
    }
    
    // 3. Actualizar pol√≠ticas de calendario
    for (const room of calendar.data.data) {
      await updateRoomPolicies(room.roomId, room.calendar);
    }
    
    console.log(`‚úÖ Synced ${availability.data.count} rooms to database`);
    
  } catch (error) {
    console.error('‚ùå Sync failed:', error.message);
    throw error;
  }
}
```

### **‚ö° Notas Importantes**

- **üîç Rate Limits**: Aplicables seg√∫n configuraci√≥n de Beds24
- **üìÖ Formato Fechas**: Siempre usar `YYYY-MM-DD`
- **üîÑ Cache**: Implementar cache para consultas frecuentes
- **üìä Paginaci√≥n**: Soportada en todos los endpoints GET
- **üè® Filtros**: Usar propertyId y roomId para optimizar consultas
- **‚è∞ Performance**: Limitar rangos de fechas para mejor rendimiento

---

## üèÜ **Resumen de Capacidades Verificadas**

‚úÖ **GET /inventory/fixedPrices**: Funcional (sin datos actuales)  
‚úÖ **GET /inventory/rooms/calendar**: Funcional con precios din√°micos reales ($145K-210K COP)  
‚úÖ **GET /inventory/rooms/availability**: Funcional con ocupaci√≥n en tiempo real  
‚úÖ **GET /inventory/rooms/unitBookings** (BETA): **¬°S√öPER FUNCIONAL!** - Tracking granular por unidad  
‚úÖ **POST /inventory/rooms/calendar**: **¬°FUNCIONAL!** - Modificaci√≥n de precios y restricciones verificada con datos reales  

**üéØ Endpoint unitBookings - Valor Excepcional:**
- **Tracking por unidad espec√≠fica**: Qu√© booking ocupa qu√© unidad exacta
- **Gesti√≥n operativa diaria**: Check-ins, check-outs, limpieza, mantenimiento
- **Alertas inteligentes**: Bookings sin asignar, rotaci√≥n r√°pida, estancias largas
- **An√°lisis de rotaci√≥n**: Frecuencia de cambios, patrones de ocupaci√≥n
- **Planificaci√≥n de mantenimiento**: Ventanas libres para reparaciones

**Sistema completamente listo para:**
- ‚úÖ **Revenue Management Completo**: Modificaci√≥n de precios verificada con datos reales
- ‚úÖ **Gesti√≥n de Temporadas**: Precios navide√±os, temporada baja, eventos especiales
- ‚úÖ **Pol√≠ticas Din√°micas**: Min/max nights por per√≠odo espec√≠fico
- ‚úÖ **Modificaci√≥n Masiva**: M√∫ltiples habitaciones en una sola operaci√≥n
- ‚úÖ **Consultas de disponibilidad**: En tiempo real con datos granulares
- ‚úÖ **Tracking por unidad**: Qu√© booking ocupa qu√© unidad espec√≠fica
- ‚úÖ **Coordinaci√≥n operativa**: Limpieza, mantenimiento, check-in/out
- ‚úÖ **Sistema de alertas**: Bookings sin asignar, rotaci√≥n r√°pida
- ‚úÖ **An√°lisis de performance**: Rotaci√≥n, ocupaci√≥n, m√©tricas por unidad
- ‚úÖ **Sincronizaci√≥n externa**: APIs, dashboards, sistemas terceros

**üéØ Endpoints Cr√≠ticos 100% Funcionales:**
- **POST /inventory/rooms/calendar**: Modificar precios/restricciones ‚úÖ **VERIFIED**
- **GET /inventory/rooms/calendar**: Consultar configuraci√≥n de precios ‚úÖ 
- **GET /inventory/rooms/availability**: Estado disponibilidad tiempo real ‚úÖ
- **GET /inventory/rooms/unitBookings**: Tracking granular por unidad ‚úÖ
